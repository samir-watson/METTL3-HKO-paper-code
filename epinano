First basecall using guppy 3.1.5 (not in a singularity)
######################
A56_1
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/A56_1/20200907_1535_MN26644_FAO43307_5892db6b/fast5 \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_1_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_1_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_1.fastq

######################
A56_2
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/A56_2/20200903_1348_MN30066_FAO43269_b5ee73c7/fast5 \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_2_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_2_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_2.fastq

######################
A56_3
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/A56_3/20201021_2153_MN26644_FAO44326_cb50bba3/fast5 \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_3_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_3_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_3.fastq

######################
B46_1
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/b46_1/20200813_1058_MN30066_FAM95743_4e79402c/fast5_pass \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_1_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_1_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_1.fastq

######################
B46_2
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/b46_2/20200813_1058_MN26644_FAM97177_f0e10c2b/fast5_pass \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_2_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_2_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_2.fastq

######################
B46_3
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/B46_3/20201021_2153_MN30066_FAO43590_2296b70a/fast5 \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_3_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_3_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_3.fastq

######################
WT_1
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_WT/WT1/20200818_1356_MN30066_FAM96325_0c489307/fast5_pass \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_1_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_1_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_1.fastq

######################
WT_2
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_WT/WT2/20200907_1543_MN30066_FAO43597_6297976a/fast5 \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_2_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_2_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_2.fastq

######################
WT_3
#######################

#!/bin/bash
#SBATCH --partition gpu
#SBATCH -c 8
#SBATCH -t 12:00:00
#SBATCH --mem-per-cpu 20G
#SBATCH --gres=gpu:2

/home/samirwatson/ont-guppy_3.1.5/bin/guppy_basecaller -i /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_WT/WT3/20201030_1817_MN30066_FAO83012_8a18447a/fast5 \
-s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_3_HQcalls_3.5.1/ \
-x cuda:all:100% \
--flowcell FLO-MIN106 \
--kit SQK-RNA002 \
-r \
--calib_detect \
--enable_trimming true \
--trim_strategy rna \
--reverse_sequence true \

cat /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_3_HQcalls_3.5.1/*.fastq > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_3.fastq



# need to make a reference file indexed with samtools faidx and with a sequence dictionary created using picard CreateSequenceDictionary
gatk CreateSequenceDictionary -R /home/samirwatson/faststorage/NAT10/GRCh38.p13.genome.fa
gatk CreateSequenceDictionary -R /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa

#########################################################################################################
########################################################################################################
mapping to transcriptome
########################################################################################################
#########################################################################################################
######
A56_1
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_1_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/A56_1/20200907_1535_MN26644_FAO43307_5892db6b/fast5 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_1.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_1.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_1.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_1.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_1.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_1.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_1_eventalign_reads.tsv


######
A56_2
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_2_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/A56_2/20200903_1348_MN30066_FAO43269_b5ee73c7/fast5 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_2.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_2.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_2.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_2.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_2.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_2.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_2_eventalign_reads.tsv

######
A56_3
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/A56_3_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/A56_3/20201021_2153_MN26644_FAO44326_cb50bba3/fast5 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_3.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_3.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_3.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_3.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_A56_3.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_3.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_3_eventalign_reads.tsv

######
B46_1
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_1_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/b46_1/20200813_1058_MN30066_FAM95743_4e79402c/fast5_pass /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_1.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_1.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_1.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_1.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_1.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_1.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_1_eventalign_reads.tsv

######
B46_2
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_2_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/b46_2/20200813_1058_MN26644_FAM97177_f0e10c2b/fast5_pass /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_2.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_2.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_2.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_2.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_2.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_2.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_2_eventalign_reads.tsv

######
B46_3
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/B46_3_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_KO/B46_3/20201021_2153_MN30066_FAO43590_2296b70a/fast5 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_3.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_3.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_3.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_3.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_B46_3.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_3.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_3_eventalign_reads.tsv

######
WT1
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_1_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_WT/WT1/20200818_1356_MN30066_FAM96325_0c489307/fast5_pass /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_1.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_1.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_1.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_1.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_1.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_1.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_1_eventalign_reads.tsv

######
WT2
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_2_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_WT/WT2/20200907_1543_MN30066_FAO43597_6297976a/fast5 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_2.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_2.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_2.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_2.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_2.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_2.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_2_eventalign_reads.tsv

######
WT3
######

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem-per-cpu 16G
#SBATCH -c 20
#SBATCH -t 12:00:00
nanopolish index -s /home/samirwatson/faststorage/METTL3/DRS_data/epinano/WT_3_HQcalls_3.5.1/sequencing_summary.txt -d /home/samirwatson/faststorage/METTL3/DRS_data/DRS_METTL3_WT/WT3/20201030_1817_MN30066_FAO83012_8a18447a/fast5 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_3.fastq
minimap2 -ax map-ont -t 20 -L /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_3.fastq | samtools view -@ 20 -bh -F 2324 -q 10 | samtools sort -@ 20 -O bam > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_3.aligned.bam
samtools index -@ 20 /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_3.aligned.bam
nanopolish eventalign -t 20 --reads /home/samirwatson/faststorage/METTL3/DRS_data/epinano/basecalled_3.1.5/basecalled_3.1.5_WT_3.fastq \
    --bam /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_3.aligned.bam \
    --genome /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa \
    --samples --print-read-names --scale-events --samples > /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_3_eventalign_reads.tsv


# first run epinano variants like this / this somehow only gives me one output so I need to generate the other outupt with the next Script Slide_variants.py

python /home/samirwatson/EpiNano-master/Epinano_Variants.py -n 12 -R /home/samirwatson/faststorage/NAT10/gencode.v33.transcripts_shorthead.fa -s /home/samirwatson/EpiNano-master/misc/sam2tsv.jar -b /home/samirwatson/faststorage/METTL3/DRS_data/epinano/test/DRS_METTL3_A56_1.aligned.bam --type t

usage: python Slide_Variants.py per_site_var kmer_length

python /home/samirwatson/EpiNano-master/misc/Slide_Variants.py DRS_METTL3_A56_2.aligned.plus_strand.per.site.csv 5

#######################################
Next I need to do either epinano error that uses error frequencies or eipnano SVM  that uses n SVM algorithm to train models and predict modifications
there is no provision for replicates so I can either combine all fastas in one superset or do each pairwise comparison individually then combine the results at the end so not ideal
OK so if I want to compute on sum of errors I first need to use the sum of error scripts . otherwise I use mis. del or ins
echo "Switching on Epinano_sumErr.py -q will include quality score to compute sum_err"

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 64G
#SBATCH -c 15
#SBATCH -t 12:00:00

python /home/samirwatson/EpiNano-master/misc/Epinano_sumErr.py --file /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_2.aligned.plus_strand.per.site.csv --out DRS_METTL3_A56_2.sum_err.csv --kmer 0 --quality
python /home/samirwatson/EpiNano-master/misc/Epinano_sumErr.py --file /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_3.aligned.plus_strand.per.site.csv --out DRS_METTL3_A56_3.sum_err.csv --kmer 0 --quality
python /home/samirwatson/EpiNano-master/misc/Epinano_sumErr.py --file /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_2.aligned.plus_strand.per.site.csv --out DRS_METTL3_B46_2.sum_err.csv --kmer 0 --quality
python /home/samirwatson/EpiNano-master/misc/Epinano_sumErr.py --file /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_3.aligned.plus_strand.per.site.csv --out DRS_METTL3_B46_3.sum_err.csv --kmer 0 --quality
python /home/samirwatson/EpiNano-master/misc/Epinano_sumErr.py --file /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_2.aligned.plus_strand.per.site.csv --out DRS_METTL3_WT_2.sum_err.csv --kmer 0 --quality
python /home/samirwatson/EpiNano-master/misc/Epinano_sumErr.py --file /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_3.aligned.plus_strand.per.site.csv --out DRS_METTL3_WT_3.sum_err.csv --kmer 0 --quality

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 15
#SBATCH -t 12:00:00

Rscript /home/samirwatson/EpiNano-master/Epinano_DiffErr.R -c 15 -t 3 -d 0.1 -f sum_err -o A56_2.WT_2_epinano_diffErr_ -k /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_2.sum_err.csv -w /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_2.sum_err.csv -p

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 15
#SBATCH -t 12:00:00

Rscript /home/samirwatson/EpiNano-master/Epinano_DiffErr.R -c 15 -t 3 -d 0.1 -f sum_err -o A56_3.WT_3_epinano_diffErr_ -k /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_A56_3.sum_err.csv -w /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_3.sum_err.csv -p

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 15
#SBATCH -t 12:00:00

Rscript /home/samirwatson/EpiNano-master/Epinano_DiffErr.R -c 15 -t 3 -d 0.1 -f sum_err -o B46_2.WT_2_epinano_diffErr_ -k /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_2.sum_err.csv -w /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_2.sum_err.csv -p

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 15
#SBATCH -t 12:00:00

Rscript /home/samirwatson/EpiNano-master/Epinano_DiffErr.R -c 15 -t 3 -d 0.1 -f sum_err -o B46_3.WT_3_epinano_diffErr_ -k /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_B46_3.sum_err.csv -w /home/samirwatson/faststorage/METTL3/DRS_data/epinano/DRS_METTL3_WT_3.sum_err.csv -p

#################################
now run epinano SVM using epinano predict. As im not yet interested in training my own models, I will use the ones that they pretrained for epinano predict. this uses misincorporation
remember to filter your dataset before or after making predicitons to keep only RRACH k-mers. (need to write this script myself - will do it afterwards

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump \
	--predict ../DRS_METTL3_A56_1.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix A56_1.delta.modification

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 2-12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump \
	--predict ../DRS_METTL3_A56_2.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix A56_2.delta.modification

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 2-12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump \
	--predict ../DRS_METTL3_A56_3.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix A56_3.delta.modification

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 2-12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump \
	--predict ../DRS_METTL3_B46_1.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix B46_1.delta.modification

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 2-12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump \
	--predict ../DRS_METTL3_B46_2.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix B46_2.delta.modification

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 2-12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump \
	--predict ../DRS_METTL3_B46_3.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix B46_3.delta.modification

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 2-12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump \
	--predict ../DRS_METTL3_WT_1.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix WT_1.delta.modification

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 2-12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump \
	--predict ../DRS_METTL3_WT_2.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix WT_2.delta.modification

#!/bin/bash
#SBATCH --partition normal
#SBATCH --account nanopore_drs
#SBATCH --mem 30G
#SBATCH -c 1
#SBATCH -t 2-12:00:00
python /home/samirwatson/EpiNano-master/Epinano_Predict.py \
	--model /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump
	--predict ../DRS_METTL3_WT_3.aligned.plus_strand.per.site.csv.per_site.5mer.csv \
	--columns 8,13,23 \
	--out_prefix WT_3.delta.modification

OK! now comes the hard part! First I need to combine the 3 replicates for each condition. to do this first I set all probablilities above 0.5 to 1

if (s1 ≥ 0.5 and/or s2 ≥ 0.5 and/or s3 ≥ 0.5):
M = 1
else:
M = (s1 + s2 + s3)/3

######### Then I do pseudocode 2
if wt/ko > 1.3 and wt >0.5 then status = modified
else
  unmodified
#####################################################################################################################################################################################################################################
#####################################################################################################################################################################################################################################
""it is important to note that for the delta features I should run it on the epinano predict outputs for the single comparisons. While for the pseudocodes which take into account the replicates, I should run that on just the plain"
"epinano predict data and on the outputs of the delta features.""
#####################################################################################################################################################################################################################################
#####################################################################################################################################################################################################################################

#R Script to merge results from epinano SVM for the replicates
# OK so first thing is to split the tables into smaller files
head  -n 5000 A56_1.modification.q3.mis3.del3.MODEL.rrach.q3.mis3.del3.linear.dump.csv > short.A56_1.modification.q3.mis3.del3.MODEL.rrach.q3.mis3.del3.linear.dump.csv
head  -n 5000 WT_2.modification.q3.mis3.del3.MODEL.rrach.q3.mis3.del3.linear.dump.csv > short.WT_2.modification.q3.mis3.del3.MODEL.rrach.q3.mis3.del3.linear.dump.csv
head  -n 5000 WT_3.modification.q3.mis3.del3.MODEL.rrach.q3.mis3.del3.linear.dump.csv > short.WT_3.modification.q3.mis3.del3.MODEL.rrach.q3.mis3.del3.linear.dump.csv
#wc -l filename  --> to check number of lines in file

#Ok now using R run the pseudocode above - saved as a R_epinanoSVM.replicates.

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem 120G
#SBATCH --account nanopore_drs
#SBATCH -c 12
#SBATCH -t 11:00:00

Rscript /home/samirwatson/faststorage/METTL3/DRS_data/epinano/epinano_SVM/R.WT.reps.R

########## OK will also have to run Epinano Predict using a different model: rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump as I first ran rrach.q3.mis3.del3.linear.dump
#################
#from https://github.com/novoalab/EpiNano/blob/master/test_data/make_predictions/run.sh then next run generate delta features
#for the delta features the column numbers change but are still for position 3 in the kmers

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem 60G
#SBATCH --account nanopore_drs
#SBATCH -c 4
#SBATCH -t 11:00:00
python /home/samirwatson/EpiNano-master/misc/Epinano_make_delta.py ../DRS_METTL3_WT_1.aligned.plus_strand.per.site.csv.per_site.5mer.csv ../DRS_METTL3_A56_1.aligned.plus_strand.per.site.csv.per_site.5mer.csv 5 5 > delta_features/WT_1_A56_1_delta.5mer.csv
echo "predict using pretrained SVM models with delta features"
python /home/samirwatson/EpiNano-master/Epinano_Predict.py -o WT_1_A56_1_SVM_Predict_delta_features -M /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump -p delta_features/WT_1_A56_1_delta.5mer.csv -cl 7,12,22

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem 60G
#SBATCH --account nanopore_drs
#SBATCH -c 4
#SBATCH -t 11:00:00
python /home/samirwatson/EpiNano-master/misc/Epinano_make_delta.py ../DRS_METTL3_WT_2.aligned.plus_strand.per.site.csv.per_site.5mer.csv ../DRS_METTL3_A56_2.aligned.plus_strand.per.site.csv.per_site.5mer.csv 5 5 > delta_features/WT_2_A56_2_delta.5mer.csv
echo "predict using pretrained SVM models with delta features"
python /home/samirwatson/EpiNano-master/Epinano_Predict.py -o delta_features/WT_2_A56_2_SVM_Predict_delta_features -M /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump -p delta_features/WT_2_A56_2_delta.5mer.csv -cl 7,12,22

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem 60G
#SBATCH --account nanopore_drs
#SBATCH -c 4
#SBATCH -t 11:00:00
python /home/samirwatson/EpiNano-master/misc/Epinano_make_delta.py ../DRS_METTL3_WT_3.aligned.plus_strand.per.site.csv.per_site.5mer.csv ../DRS_METTL3_A56_3.aligned.plus_strand.per.site.csv.per_site.5mer.csv 5 5 > delta_features/WT_3_A56_3_delta.5mer.csv
echo "predict using pretrained SVM models with delta features"
python /home/samirwatson/EpiNano-master/Epinano_Predict.py -o delta_features/WT_3_A56_3_SVM_Predict_delta_features -M /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump -p delta_features/WT_3_A56_3_delta.5mer.csv -cl 7,12,22

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem 60G
#SBATCH --account nanopore_drs
#SBATCH -c 4
#SBATCH -t 11:00:00
python /home/samirwatson/EpiNano-master/misc/Epinano_make_delta.py ../DRS_METTL3_WT_1.aligned.plus_strand.per.site.csv.per_site.5mer.csv ../DRS_METTL3_B46_1.aligned.plus_strand.per.site.csv.per_site.5mer.csv 5 5 > delta_features/WT_1_B46_1_delta.5mer.csv
echo "predict using pretrained SVM models with delta features"
python /home/samirwatson/EpiNano-master/Epinano_Predict.py -o delta_features/WT_1_B46_1_SVM_Predict_delta_features -M /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump -p delta_features/WT_1_B46_1_delta.5mer.csv -cl 7,12,22

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem 60G
#SBATCH --account nanopore_drs
#SBATCH -c 4
#SBATCH -t 11:00:00
python /home/samirwatson/EpiNano-master/misc/Epinano_make_delta.py ../DRS_METTL3_WT_2.aligned.plus_strand.per.site.csv.per_site.5mer.csv ../DRS_METTL3_B46_2.aligned.plus_strand.per.site.csv.per_site.5mer.csv 5 5 > delta_features/WT_2_B46_2_delta.5mer.csv
echo "predict using pretrained SVM models with delta features"
python /home/samirwatson/EpiNano-master/Epinano_Predict.py -o delta_features/WT_2_B46_2_SVM_Predict_delta_features -M /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump -p delta_features/WT_2_B46_2_delta.5mer.csv -cl 7,12,22

#!/bin/bash
#SBATCH --partition normal
#SBATCH --mem 60G
#SBATCH --account nanopore_drs
#SBATCH -c 4
#SBATCH -t 11:00:00
python /home/samirwatson/EpiNano-master/misc/Epinano_make_delta.py ../DRS_METTL3_WT_3.aligned.plus_strand.per.site.csv.per_site.5mer.csv ../DRS_METTL3_B46_3.aligned.plus_strand.per.site.csv.per_site.5mer.csv 5 5 > delta_features/WT_3_B46_3_delta.5mer.csv
echo "predict using pretrained SVM models with delta features"
python /home/samirwatson/EpiNano-master/Epinano_Predict.py -o delta_features/WT_3_B46_3_SVM_Predict_delta_features -M /home/samirwatson/EpiNano-master/models/rrach.deltaQ3.deltaMis3.deltaDel3.linear.dump -p delta_features/WT_3_B46_3_delta.5mer.csv -cl 7,12,22
